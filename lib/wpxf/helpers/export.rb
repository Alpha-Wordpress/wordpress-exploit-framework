# frozen_string_literal: true

module Wpxf
  module Helpers
    # Provides helper methods for common functionality used to export files.
    module Export
      # Register the export_path option.
      # @param required [Boolean] a value indicating whether the option should be required.
      # @return [StringOption] the newly registered option.
      def register_export_path_option(required)
        opt = StringOption.new(
          name: 'export_path',
          desc: 'The path to save the file to',
          required: required
        )

        register_option(opt)
        opt
      end

      # @return [String] the path to save the file to.
      def export_path
        return nil if normalized_option_value('export_path').nil?
        File.expand_path normalized_option_value('export_path')
      end

      # @return [String] the path to a unique filename in the wpxf home directory.
      def generate_unique_filename(file_extension)
        storage_path = File.join(Dir.home, '.wpxf')
        FileUtils.mkdir_p(storage_path) unless File.directory?(storage_path)
        filename = "#{Time.now.strftime('%Y-%m-%d_%H-%M-%S')}#{file_extension}"
        File.join(storage_path, filename)
      end
    end
  end
end
