# frozen_string_literal: true

require_relative '../../spec_helper'

describe Models::Workspace, type: :model do
  it { is_expected.to have_one_to_many :credentials }
  it { is_expected.to validate_presence :name }
  it { is_expected.to validate_format(/^[A-Za-z0-9_]{1,50}$/, :name) }
  it { is_expected.to validate_unique :name }

  describe '#destroy' do
    it 'should destroy associated credentials' do
      subject = Models::Workspace.first
      subject.add_credential(host: 'foo', port: 80, type: 'plain')
      subject.add_credential(host: 'bar', port: 80, type: 'plain')
      expect(Models::Credential.where(port: 80).count).to eql 2

      subject.destroy
      expect(Models::Credential.where(port: 80).count).to eql 0
    end
  end
end
